# 250116 숙제 4일차 (web RTC)

### WebRTC란?

- WebRTC(Web Real-Time Communication)는 브라우저 간 **실시간 커뮤니케이션**을 가능하게 하는 기술로, 플러그인이나 별도 설치 없이 **음성, 영상 통화**, **데이터 전송**이 가능합니다.
- 주로 **P2P(Peer-to-Peer) 통신** 방식으로 동작하며, 낮은 지연 시간으로 데이터를 송수신할 수 있어 영상 통화, 라이브 스트리밍, 온라인 협업 도구 등에 활용됩니다.
- WebRTC는 Google이 오픈소스로 개발했으며, 현재 다양한 브라우저와 플랫폼에서 지원합니다.

---

### WebRTC의 특징

| **항목** | **설명** |
| --- | --- |
| **실시간 통신** | 브라우저 간 네트워크를 통해 음성, 영상 및 데이터를 실시간으로 주고받을 수 있음. |
| **P2P 통신** | 서버를 거치지 않고 클라이언트 간 직접 연결로 데이터를 전송, 낮은 지연 시간 제공. |
| **오픈 소스** | 무료로 사용 가능한 기술이며, 다양한 플랫폼 및 언어에서 구현 가능. |
| **플러그인 불필요** | 별도의 설치 없이 브라우저만으로 실행 가능. |
| **암호화 보안** | DTLS 및 SRTP를 이용해 데이터 암호화를 지원, 안전한 통신 환경 제공. |

---

### WebRTC 주요 구성 요소

WebRTC는 크게 세 가지 주요 API로 구성됩니다.

| **구성 요소** | **설명** |
| --- | --- |
| **1. MediaStream** | 사용자 디바이스(카메라, 마이크 등)에서 오디오와 비디오 데이터를 캡처하여 스트림으로 제공. |
| **2. RTCPeerConnection** | P2P 연결을 관리하며, 오디오, 비디오 및 데이터를 송수신. |
| **3. RTCDataChannel** | 텍스트, 파일 등 구조화된 데이터를 브라우저 간 송수신. |

---

### WebRTC 통신 흐름

1. **신호 교환(Signaling)**
    - WebRTC는 P2P 연결 전, **Signaling 서버**를 사용해 초기 연결 정보를 교환(SDP, ICE Candidates).
    - Signaling 방식: WebSocket, HTTP 등을 통해 구현.
2. **P2P 연결 설정**
    - ICE (Interactive Connectivity Establishment)를 사용하여 최적의 경로 탐색.
    - NAT 및 방화벽을 넘어 연결을 설정.
3. **미디어 및 데이터 송수신**
    - 오디오, 비디오 및 데이터 스트림을 실시간으로 전송.

---

### WebRTC 작동 원리

| **단계** | **설명** |
| --- | --- |
| **1. Device Access** | `getUserMedia()` API를 통해 사용자의 카메라, 마이크 접근 권한 획득 및 미디어 스트림 캡처. |
| **2. Signaling** | WebSocket 등을 통해 SDP(Session Description Protocol) 및 ICE Candidate 정보 교환. |
| **3. Connection Setup** | RTCPeerConnection을 통해 P2P 연결 설정 및 최적의 네트워크 경로 탐색. |
| **4. Media/Message Transfer** | RTCDataChannel과 MediaStream을 통해 실시간 데이터 및 미디어 송수신. |

---

### WebRTC의 장점

1. **실시간 통신**
    - 서버를 거치지 않고 브라우저 간 직접 연결로 빠른 데이터 전송.
2. **플러그인 불필요**
    - 추가 설치 없이 브라우저에서 즉시 사용 가능.
3. **범용성**
    - Chrome, Firefox, Safari 등 대부분의 브라우저 지원.
4. **보안성**
    - 통신 데이터가 기본적으로 암호화되어 안전한 환경 제공.

---

### WebRTC의 단점

1. **복잡한 초기 연결**
    - P2P 연결을 위해 Signaling, ICE Candidate 교환 등 설정 과정이 필요.
2. **NAT Traversal 문제**
    - 방화벽이나 NAT 환경에서 연결 설정이 어려울 수 있음.
3. **브라우저 간 호환성**
    - 브라우저 간 API 지원 상태가 다를 수 있어 추가적인 호환성 작업 필요.
4. **서버 필요**
    - Signaling을 위해 별도의 서버가 필요하며, 초기 연결 시 서버 자원 사용.

---

### WebRTC 주요 API

| **API** | **설명** |
| --- | --- |
| **getUserMedia()** | 사용자의 카메라, 마이크 등을 캡처하여 MediaStream을 생성. |
| **RTCPeerConnection** | P2P 연결 설정 및 관리. 오디오, 비디오 데이터 송수신. |
| **RTCDataChannel** | 구조화된 데이터를 P2P로 송수신. 파일 전송, 채팅 등에 사용. |
| **ICE Candidate** | 최적의 연결 경로를 탐색하기 위해 네트워크 후보군 제공. |

---

### WebRTC 코드

```jsx
javascript
복사편집
// 1. MediaStream: 사용자 미디어 접근
navigator.mediaDevices.getUserMedia({ video: true, audio: true })
  .then(stream => {
    document.querySelector('video').srcObject = stream;
  })
  .catch(error => console.error('Media access error:', error));

// 2. PeerConnection: P2P 연결 설정
const peerConnection = new RTCPeerConnection();
peerConnection.onicecandidate = event => {
  if (event.candidate) {
    console.log('ICE Candidate:', event.candidate);
  }
};

// 3. DataChannel: 데이터 전송
const dataChannel = peerConnection.createDataChannel('chat');
dataChannel.onmessage = event => console.log('Received:', event.data);
dataChannel.send('Hello, WebRTC!');

```

---

### WebRTC의 활용 사례

1. **화상 회의**
    - Zoom, Google Meet 같은 화상 회의 서비스에서 사용.
2. **라이브 스트리밍**
    - 실시간 스트리밍 플랫폼 구현.
3. **P2P 파일 전송**
    - 대용량 파일을 서버를 거치지 않고 직접 전송.
4. **온라인 협업 도구**
    - Google Docs, Figma 등에서 실시간 편집 협업 지원.

---

### WebRTC와 다른 기술 비교

| **기술** | **WebRTC** | **Socket.io/WebSocket** |
| --- | --- | --- |
| **주요 목적** | 실시간 음성, 영상 및 데이터 전송 | 실시간 텍스트 기반 데이터 전송 |
| **P2P 지원** | 가능 | 불가능 (항상 서버를 통해 통신) |
| **성능** | 낮은 지연 시간, 대역폭 최적화 | 텍스트 데이터 전송에 최적화 |
| **복잡성** | 높은 초기 설정 요구 | 상대적으로 간단 |

---

### 오늘의 궁금증

**P2P 방식이 네트워크 환경에 따라 실패한다면 어떻게 해결할 수 있을까?**

1. **TURN 서버 사용**
    - P2P 연결이 불가능할 때 데이터를 중계하는 서버를 활용.
    - 성능은 떨어지지만 연결 실패를 방지.
2. **네트워크 품질 최적화**
    - 대역폭 조정, 코덱 변경(H.264, VP8)으로 네트워크 상태에 적응.